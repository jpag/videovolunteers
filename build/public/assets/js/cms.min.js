var cms=new Object;cms.page=1;cms.action="index";cms.debug=false;cms.offsetTop=70;cms.adminPath="/admin/";cms.correspondentPost="/correspondents/json";cms.videoPost="/videos/json";cms.correspondentsFields=[{postVal:"name",domName:"title",type:"input"},{postVal:"fbhandle",domName:"fb",type:"input"},{postVal:"twitterhandle",domName:"twitterhandle",type:"input"},{postVal:"address",domName:"address",type:"input"}];
cms.videosFields=[{postVal:"title",domName:"title",type:"input"},{postVal:"youtubeid",domName:"youtubeid",type:"input"},{postVal:"correspondent",domName:"correspondent",type:"select"},{postVal:"issues",domName:"issues",type:"checkbox",checkboxes:["Education","Corruption","Justice","Woman's Rights","Environment"]},{postVal:"posted",domName:"posted",type:"multi-input",defaults:["MM","DD","YYYY"],order:[2,0,1]}];cms.pageFields;
cms.init=function(p,a){cms.action=a;cms.page=p;if(cms.action=="correspondents")cms.pageFields=cms.correspondentsFields;else cms.pageFields=cms.videosFields};
cms.createNewEntry=function(){trace(" create new entry "+cms.action);$("#create-new .small-message").html("");for(var i=0;i<cms.pageFields.length;i++)if(cms.pageFields[i].type=="select")$("#create-"+cms.pageFields[i].domName+"-input select").val("");else if(cms.pageFields[i].type=="checkbox"){var children=$("#create-"+cms.pageFields[i].domName+"-input li input");for(var c=0;c<children.length;c++)$(children[c]).attr("checked",false)}else if(cms.pageFields[i].type=="multi-input")for(var mi=0;mi<$("#create-"+
cms.pageFields[i].domName+"-input input").length;mi++)$($("#create-"+cms.pageFields[i].domName+"-input input")[mi]).val(cms.pageFields[i].defaults[mi]);else $("#create-"+cms.pageFields[i].domName+"-input input").val("");$("#lightbox").fadeIn(10);$("#create-new").fadeIn(100)};
cms.newSave=function(){var error=false;var url=cms.adminPath+"add";var data=new Object;for(var i=0;i<cms.pageFields.length;i++)if(cms.pageFields[i].type=="select")data[cms.pageFields[i].postVal]=$("#create-"+cms.pageFields[i].domName+"-input select").val();else if(cms.pageFields[i].type=="checkbox"){data[cms.pageFields[i].postVal]="";var children=$("#create-"+cms.pageFields[i].domName+"-input li input");for(var c=0;c<children.length;c++){var isChecked=$(children[c]).is(":checked");trace(" is checked "+
isChecked+" ---- ? ");if(isChecked)data[cms.pageFields[i].postVal]+="1";else data[cms.pageFields[i].postVal]+="0"}}else if(cms.pageFields[i].type=="multi-input"){var milength=cms.pageFields[i].order.length;var multiInputTxt="";for(var mi=0;mi<milength;mi++){var nextInOrder=cms.pageFields[i].order[mi];var inputValue=$($("#create-"+cms.pageFields[i].domName+"-input input")[nextInOrder]).val();if(inputValue.length==1)inputValue="0"+inputValue;multiInputTxt+=inputValue;if(mi<milength-1)multiInputTxt+=
"-"}data[cms.pageFields[i].postVal]=multiInputTxt}else data[cms.pageFields[i].postVal]=$("#create-"+cms.pageFields[i].domName+"-input input").val();if(cms.action=="correspondents"){if(data.name.length<1)error="Name is required.";else if(data.fbhandle.length<2&&data.twitterhandle.length<2)error="You must fill out either the Facebook or Twitter information.";url+=cms.correspondentPost}else{trace(" ---- posted data");trace(data);trace("------");if(data.title.length<3)error="Title is Too Short";else if(data.youtubeid.length<
3)error="Not a valid youtube ID";else if(data.posted.length<10||data.posted=="MM-DD-YYYY")error="Valid Date Required MM-DD-YYYY";else if(data.issues=="00000")error="No issues defined";else if(data.correspondent==-1)error="No correspondent selected";url+=cms.videoPost}if(error)cms.newDisplayError(error);else{cms.displayLoader();$.post(url,data,cms.newSaveComplete)}};cms.newDisplayError=function(er){$("#create-new .small-message").html(er)};
cms.newSaveComplete=function(data){trace(data);$("#loading-content").fadeOut(10);$("#new-success").fadeIn(100)};cms.closeSuccessMessage=function(){$("#new-success").fadeOut(100);$("#lightbox").fadeOut(100);$("#refreshPage").fadeIn(100)};cms.newCancel=function(){$("#create-new").fadeOut(100);$("#lightbox").fadeOut(100)};
cms.updateItem=function(id){trace(" update item "+id);var top=$("#entry_"+id).offset().top-cms.offsetTop;$("#edit").css({"top":top});$("#edit").fadeIn(100);$("#lightbox").fadeIn(10);$("#edit #edit-error").css({"display":"none"});$("#edit-id-input input").val(id);for(var i=0;i<cms.pageFields.length;i++)if(cms.pageFields[i].type=="select"){var selectField=$("#entry_"+id+" ."+cms.pageFields[i].domName).data("val");$("#edit-"+cms.pageFields[i].domName+"-input select").val(selectField)}else if(cms.pageFields[i].type==
"checkbox"){var checkboxData=$("#entry_"+id+" ."+cms.pageFields[i].domName).data(cms.pageFields[i].domName);checkboxData=String(checkboxData).split("");$("#edit-"+cms.pageFields[i].domName+"-input input").attr("checked",false);var inputs=$("#edit-"+cms.pageFields[i].domName+"-input input");for(var cb=0;cb<inputs.length;cb++){var checked=checkboxData[cb];if(checked=="1")$(inputs[cb]).attr("checked",true);else $(inputs[cb]).attr("checked",false)}}else if(cms.pageFields[i].type=="multi-input"){if(cms.pageFields[i].domName==
"posted"){var date=$("#entry_"+id+" ."+cms.pageFields[i].domName+" span").html();var dateArray=date.split("-");for(var d=0;d<cms.pageFields[i].order.length;d++)$($("#edit-"+cms.pageFields[i].domName+"-input input")[cms.pageFields[i].order[d]]).val(dateArray[d])}}else{var field=$("#entry_"+id+" ."+cms.pageFields[i].domName+" span").html();$("#edit-"+cms.pageFields[i].domName+"-input input").val(field)}};
cms.updateSave=function(){var error=false;$("#edit #edit-error").css({"display":"none"});var url=cms.adminPath+"update";var data=new Object;data.id=$("#edit-id-input input").val();if(cms.action=="correspondents")url+=cms.correspondentPost;else if(cms.action=="videos")url+=cms.videoPost;for(var i=0;i<cms.pageFields.length;i++)if(cms.pageFields[i].type=="input"){data[cms.pageFields[i].postVal]=$("#edit-"+cms.pageFields[i].domName+"-input input").val();$("#entry_"+data.id+" ."+cms.pageFields[i].domName+
" span ").html(data[cms.pageFields[i].postVal])}else if(cms.pageFields[i].type=="select"){var selectID=$("#edit-"+cms.pageFields[i].domName+"-input select").val();data[cms.pageFields[i].postVal]=selectID;var valueName=$("#edit-"+cms.pageFields[i].domName+"-input select option[value='"+selectID+"']").html();$("#entry_"+data.id+" ."+cms.pageFields[i].domName).data("val",selectID);$("#entry_"+data.id+" ."+cms.pageFields[i].domName+" span ").html(valueName)}else if(cms.pageFields[i].type=="checkbox"){var inputs=
$("#edit-"+cms.pageFields[i].domName+"-input input");var datastring="";var issuesConverted="";for(var cb=0;cb<inputs.length;cb++)if($(inputs[cb]).attr("checked")){datastring+="1";if(cms.pageFields[i].domName=="issues")issuesConverted+=issuesAbreviated[cb]+", "}else datastring+="0";data[cms.pageFields[i].postVal]=datastring;$("#entry_"+data.id+" ."+cms.pageFields[i].domName).data("issues",datastring);trace($("#entry_"+data.id+" ."+cms.pageFields[i].domName).data());if(cms.pageFields[i].domName=="issues"){issuesConverted=
issuesConverted.slice(0,-2);$("#entry_"+data.id+" ."+cms.pageFields[i].domName+" span ").html(issuesConverted)}}else if(cms.pageFields[i].type=="multi-input")if(cms.pageFields[i].domName=="posted"){var dateConcated="";var dlength=cms.pageFields[i].order.length;for(var d=0;d<dlength;d++){var inputValue=$($("#edit-"+cms.pageFields[i].domName+"-input input")[cms.pageFields[i].order[d]]).val();if(inputValue.length==1)inputValue="0"+inputValue;dateConcated+=inputValue;if(d<dlength-1)dateConcated+="-"}$("#entry_"+
data.id+" ."+cms.pageFields[i].domName+" span").html(dateConcated);data[cms.pageFields[i].postVal]=dateConcated}if(cms.action=="correspondents");else if(cms.action=="videos")if(data.title.length<3)error="Title is Too Short";else if(data.youtubeid.length<3)error="Not a valid youtube ID";else if(data.posted.length<10||data.posted=="MM-DD-YYYY")error="Valid Date Required MM-DD-YYYY";else if(data.issues=="00000")error="No issues defined";else if(data.correspondent==-1)error="No correspondent selected";
trace(data);if(error)cms.editDisplayError(error);else{cms.displayLoader();$.post(url,data,cms.updateComplete)}};cms.editDisplayError=function(error){trace(error);$("#edit #edit-error").fadeIn();$("#edit #edit-error").html("Error: "+error)};cms.updateComplete=function(data){trace(data);if(data.page=="video"){trace($("#entry_"+data.id));$("#entry_"+data.id).removeClass("inactive")}cms.hideLoader()};cms.updateCancel=function(){$("#edit").fadeOut(100);$("#lightbox").fadeOut(200)};
cms.deleteEntry=function(id){var top=$("#entry_"+id).offset().top-cms.offsetTop;$("#confirm-delete").css({"top":top});$("#confirm-delete").data("id",id);$("#confirm-delete .message").html("Are you sure you want to delete "+$("#entry_"+id+" .title span ").html());$("#confirm-delete").fadeIn(100);$("#lightbox").fadeIn(10)};cms.deleteCancel=function(){$("#confirm-delete").fadeOut(100);$("#lightbox").fadeOut(10)};
cms.deleteConfirm=function(){cms.displayLoader();var url=cms.adminPath+"delete";var data=new Object;data.id=$("#confirm-delete").data("id");if(cms.action=="correspondents")url+=cms.correspondentPost;else if(cms.action=="videos")url+=cms.videoPost;$.post(url,data,cms.deleteComplete)};cms.deleteComplete=function(data){trace(data);cms.hideLoader();$("#entry_"+data.id).fadeOut();$("#entry_edit_box_"+data.id).fadeOut();$("#entry_"+data.id).parent().css({"background-image":"url('/assets/images/cms/stripe.png')"})};
cms.displayLoader=function(){$("#confirm-delete").fadeOut(100);$("#edit").fadeOut(100);$("#create-new").fadeOut(100);$("#loading-content").fadeIn(10)};cms.hideLoader=function(){$("#loading-content").fadeOut(10);$("#lightbox").fadeOut(100)};$("#addentry").click(function(){cms.createNewEntry()});$("#create-new .save-cancel").click(function(){cms.newCancel()});$("#create-new .save-changes").click(function(){cms.newSave()});$("#new-success").click(function(){cms.closeSuccessMessage()});$("#refreshPage").click(function(){location.reload(true)});
$(".delete-item").click(function(){cms.deleteEntry($(this).data("id"))});$(".delete-item").click(function(){cms.deleteEntry($(this).data("id"))});$("#confirm-delete .delete-cancel").click(function(){cms.deleteCancel()});$("#confirm-delete .delete-confirm").click(function(){cms.deleteConfirm()});$(".list-item").click(function(){cms.updateItem($(this).data("id"))});$(".edit-item").click(function(){cms.updateItem($(this).data("id"))});$("#edit .save-cancel").click(function(){cms.updateCancel()});$("#edit .save-changes").click(function(){cms.updateSave()});
function trace(str){if(cms.debug==true)console.log(str)};